var oe=Object.defineProperty;var ae=(e,t,r)=>t in e?oe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var D=(e,t,r)=>ae(e,typeof t!="symbol"?t+"":t,r);import{ao as commonjsGlobal,ap as getDefaultExportFromCjs,f as dayjs,r as ref,aX as standardFieldsStore,Z as mapCustomValues,aR as parseAndFetchUserData,c as computed,T as usePreviewStore,C as useRouter,aY as defaultPadding,aZ as defaultShadow,a_ as fieldTypeMaxScore,a$ as fieldTypeSumScore,b0 as SCORE_FORMAT,I as useRuntimeConfig}from"./8xvvzpeQ.js";import{e as countries,P as PaymentServices,a as attributionEventData,g as getSessionId,b as getSessionFingerprint,H as HISTORY_KEY,U as USER_SESSION_KEY,h as USER_SESSION_HISTORY_KEY,j as USER_FINGERPRINT_KEY,k as FIRST_EVENT_KEY}from"./oo_a1T_D.js";var customParseFormat$1={exports:{}};(function(e,t){(function(r,o){e.exports=o()})(commonjsGlobal,function(){var r={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},o=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|Q|YYYY|YY?|ww?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,a=/\d/,u=/\d\d/,i=/\d\d?/,d=/\d*[^-_:/,()\s\d]+/,n={},l=function(g){return(g=+g)+(g>68?1900:2e3)},c=function(g){return function(s){this[g]=+s}},S=[/[+-]\d\d:?(\d\d)?|Z/,function(g){(this.zone||(this.zone={})).offset=function(s){if(!s||s==="Z")return 0;var m=s.match(/([+-]|\d\d)/g),v=60*m[1]+(+m[2]||0);return v===0?0:m[0]==="+"?-v:v}(g)}],f=function(g){var s=n[g];return s&&(s.indexOf?s:s.s.concat(s.f))},h=function(g,s){var m,v=n.meridiem;if(v){for(var p=1;p<=24;p+=1)if(g.indexOf(v(p,0,s))>-1){m=p>12;break}}else m=g===(s?"pm":"PM");return m},b={A:[d,function(g){this.afternoon=h(g,!1)}],a:[d,function(g){this.afternoon=h(g,!0)}],Q:[a,function(g){this.month=3*(g-1)+1}],S:[a,function(g){this.milliseconds=100*+g}],SS:[u,function(g){this.milliseconds=10*+g}],SSS:[/\d{3}/,function(g){this.milliseconds=+g}],s:[i,c("seconds")],ss:[i,c("seconds")],m:[i,c("minutes")],mm:[i,c("minutes")],H:[i,c("hours")],h:[i,c("hours")],HH:[i,c("hours")],hh:[i,c("hours")],D:[i,c("day")],DD:[u,c("day")],Do:[d,function(g){var s=n.ordinal,m=g.match(/\d+/);if(this.day=m[0],s)for(var v=1;v<=31;v+=1)s(v).replace(/\[|\]/g,"")===g&&(this.day=v)}],w:[i,c("week")],ww:[u,c("week")],M:[i,c("month")],MM:[u,c("month")],MMM:[d,function(g){var s=f("months"),m=(f("monthsShort")||s.map(function(v){return v.slice(0,3)})).indexOf(g)+1;if(m<1)throw new Error;this.month=m%12||m}],MMMM:[d,function(g){var s=f("months").indexOf(g)+1;if(s<1)throw new Error;this.month=s%12||s}],Y:[/[+-]?\d+/,c("year")],YY:[u,function(g){this.year=l(g)}],YYYY:[/\d{4}/,c("year")],Z:S,ZZ:S};function O(g){var s,m;s=g,m=n&&n.formats;for(var v=(g=s.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(F,C,x){var T=x&&x.toUpperCase();return C||m[x]||r[x]||m[T].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(R,I,M){return I||M.slice(1)})})).match(o),p=v.length,y=0;y<p;y+=1){var w=v[y],E=b[w],A=E&&E[0],P=E&&E[1];v[y]=P?{regex:A,parser:P}:w.replace(/^\[|\]$/g,"")}return function(F){for(var C={},x=0,T=0;x<p;x+=1){var R=v[x];if(typeof R=="string")T+=R.length;else{var I=R.regex,M=R.parser,Y=F.slice(T),K=I.exec(Y)[0];M.call(C,K),F=F.replace(K,"")}}return function(L){var U=L.afternoon;if(U!==void 0){var _=L.hours;U?_<12&&(L.hours+=12):_===12&&(L.hours=0),delete L.afternoon}}(C),C}}return function(g,s,m){m.p.customParseFormat=!0,g&&g.parseTwoDigitYear&&(l=g.parseTwoDigitYear);var v=s.prototype,p=v.parse;v.parse=function(y){var w=y.date,E=y.utc,A=y.args;this.$u=E;var P=A[1];if(typeof P=="string"){var F=A[2]===!0,C=A[3]===!0,x=F||C,T=A[2];C&&(T=A[2]),n=this.$locale(),!F&&T&&(n=m.Ls[T]),this.$d=function(Y,K,L,U){try{if(["x","X"].indexOf(K)>-1)return new Date((K==="X"?1e3:1)*Y);var _=O(K)(Y),j=_.year,N=_.month,X=_.day,W=_.hours,ee=_.minutes,te=_.seconds,re=_.milliseconds,q=_.zone,G=_.week,V=new Date,k=X||(j||N?1:V.getDate()),H=j||V.getFullYear(),B=0;j&&!N||(B=N>0?N-1:V.getMonth());var $,Q=W||0,z=ee||0,J=te||0,Z=re||0;return q?new Date(Date.UTC(H,B,k,Q,z,J,Z+60*q.offset*1e3)):L?new Date(Date.UTC(H,B,k,Q,z,J,Z)):($=new Date(H,B,k,Q,z,J,Z),G&&($=U($).week(G).toDate()),$)}catch{return new Date("")}}(w,P,E,m),this.init(),T&&T!==!0&&(this.$L=this.locale(T).$L),x&&w!=this.format(P)&&(this.$d=new Date("")),n={}}else if(P instanceof Array)for(var R=P.length,I=1;I<=R;I+=1){A[1]=P[I-1];var M=m.apply(this,A);if(M.isValid()){this.$d=M.$d,this.$L=M.$L,this.init();break}I===R&&(this.$d=new Date(""))}else p.call(this,y)}}})})(customParseFormat$1);var customParseFormatExports=customParseFormat$1.exports;const customParseFormat=getDefaultExportFromCjs(customParseFormatExports);dayjs.extend(customParseFormat);const urlRegex=/[(http(s)?):\/\/(www\.)?a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,10}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/,emailRegex=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,validUrl=e=>e?urlRegex.test(e):!0,isEmpty=e=>e==null||typeof e=="string"&&e.trim()==="",validPhone=(e,t)=>{var o;if(!e)return!0;const r=(o=window==null?void 0:window.libphonenumber)==null?void 0:o.parsePhoneNumberFromString(e,t);return r?r.isValid():!1},validEmail=e=>e?emailRegex.test(e):!0,verifyEmail=e=>emailRegex.test(e),isDateEarlier=(e,t)=>e?dayjs(e,t).isBefore(dayjs()):!0,hasAlphabet=e=>/^[A-Za-z]+/.test(e);dayjs.extend(customParseFormat);const fillDataForStandardFieldUri=async(e,t,r,o,a,u,i={},d=!1)=>{const n=ref(r),l=ref(o),c=ref(a),S=ref(u);let f=e||t.query;d&&(f={});const h=standardFieldsStore.map(s=>{var v;if(s in f)if(s==="phone"&&f[s]){let p=f[s];f[s][0]===" "&&(p=p.split(""),p[0]="+",p=p.join("")),n.value.phone=p}else s==="country"&&f[s]&&countries.hasOwnProperty(f[s])?l.value=countries[f[s]]:c.value[s]=(v=f[s])==null?void 0:v.replace(/\+/g," ")});await Promise.all(h);let b=[];const O=await Promise.all(S.value.map(s=>{s.hiddenFieldQueryKey&&b.push(s)}));await Promise.all(O);const g=b.map(s=>{var v,p,y,w,E,A,P;if(s.hiddenFieldQueryKey in f)if(s.type==="phone"&&f[s.hiddenFieldQueryKey]){let F=f[s.hiddenFieldQueryKey];f[s.hiddenFieldQueryKey][0]===" "&&(F=F.split(""),F[0]="+",F=F.join("")),n.value[s.tag]=F}else if(s.type==="checkbox")if(f[s.hiddenFieldQueryKey].includes(",")){let F=f[s.hiddenFieldQueryKey].split(",");c.value[s.tag]=F.map(C=>C==null?void 0:C.trim())}else c.value[s.tag]=[f[s.hiddenFieldQueryKey]];else if(s.type==="email")c.value[s.tag]=(v=f[s.hiddenFieldQueryKey])==null?void 0:v.replace(/ /g,"+");else if(s.type==="date"){const F=((p=s.format)==null?void 0:p.replace(/-/g,s.separator||"-"))||"YYYY-MM-DD",C=(y=f[s.hiddenFieldQueryKey])==null?void 0:y.replace(/ /g,""),x=dayjs(C,[F,"MMMDoYYYY","MMM Do YYYY"]).isValid()?dayjs(C,[F,"MMMDoYYYY"]).format(F):"";c.value[s.tag]=dayjs(x,F,!0).isValid()?x:""}else s.type==="monetory"?c.value[s.tag]=(w=f[s.hiddenFieldQueryKey])==null?void 0:w.replace(/[^\d.,]/g,""):c.value[s.tag]=(E=f[s.hiddenFieldQueryKey])==null?void 0:E.replace(/\+/g," ");else{if(s.type==="phone"&&s.hiddenFieldValue){let F=s.hiddenFieldValue;s.hiddenFieldValue[0]===" "&&(F=F.split(""),F[0]="+",F=F.join("")),n.value[s.tag]=F}if(s.type==="date"&&s.hiddenFieldValue){const F=((A=s.format)==null?void 0:A.replace(/-/g,s.separator||"-"))||"YYYY-MM-DD",C=mapCustomValues(s.hiddenFieldValue||c.value[s.tag]),x=dayjs(C,[F,"MMMDoYYYY","MMM Do YYYY"]).isValid()?dayjs(C,[F,"MMMDoYYYY"]).format(F):"";c.value[s.tag]=dayjs(x,F,!0).isValid()?x:""}else s.hiddenFieldValue&&(c.value[s.tag]=(P=mapCustomValues(s.hiddenFieldValue))==null?void 0:P.replace(/\+/g," "))}});return await Promise.all(g),{phoneCountryIncluded:n.value,formattedCountry:l.value,formFieldsValue:c.value,formFields:S.value}},fillDataFromCookie=async(e,t,r,o,a,u,i={})=>{const d=ref(o),n=ref(a),l=ref(u),c=e||parseAndFetchUserData(t);if(!c)return;const S=standardFieldsStore.map(f=>{if(r.includes(f))if(f==="phone"){let h=c[f];h&&h[0]===" "&&(h=h.split(""),h[0]="+",h=h.join("")),n.value.phone=h}else f==="country"&&c[f]?l.value=countries[c[f]]:f==="address"&&!c[f]&&c.address1?d.value[f]=c.address1:d.value[f]=c[f]});return await Promise.all(S),{formFieldsValue:d.value,formattedCountry:l.value,phoneCountryIncluded:n.value}},getCountryFieldValue=(e,t)=>{const r=ref(e),o=ref(t);return o.value&&(r.value.country=Object.keys(countries).find(a=>countries[a]===o.value)),{formFieldsValue:r.value}},getHiddenFieldValue=async(e,t,r)=>{const o=e.query,a=ref(r),u=t.map(i=>{i.hidden&&i.type!="source"&&(!i.hiddenFieldQueryKey||!(i.hiddenFieldQueryKey in o))&&(a.value[i.tag]=a.value[i.tag]||i.hiddenFieldValue)});return await Promise.all(u),{formFieldsValue:a.value}},getTotalFilesSize=e=>{let t=0;return Object.keys(e).forEach(r=>{if(e[r]instanceof File)t+=e[r].size;else if(e[r]&&e[r].hasOwnProperty("files")){let o=e[r].files.length;for(let a=0;a<o;a++)t+=e[r].files[a].size}}),t},usePreviewStyle=()=>{const e=ref({}),t=computed(()=>{const n=e.value||{},l=n.margin,c=(l==null?void 0:l.top)??n.marginTop;return!(c===void 0||c===""||c==="auto")}),r=n=>n==="auto"?"auto":n===void 0||n===""?"":parseFloat(n)+"px",o=()=>{var c,S,f,h,b;const n=((S=(c=e.value)==null?void 0:c.margin)==null?void 0:S.top)??((f=e.value)==null?void 0:f.marginTop),l=(b=(h=e.value)==null?void 0:h.margin)==null?void 0:b.bottom;return{marginTop:r(n),marginBottom:r(l)}},a=()=>{var n,l,c,S,f,h,b,O,g,s,m,v,p,y,w,E,A,P,F,C,x,T,R;return{backgroundColor:"#"+((n=e.value)==null?void 0:n.bgColor),color:"#"+((l=e.value)==null?void 0:l.color),border:((c=e.value)==null?void 0:c.border)+"px "+((S=e.value)==null?void 0:S.borderStyle)+" #"+e.value.borderColor,borderRadius:e.value.radius+"px",maxWidth:e.value.width+"px",width:"100%",borderColor:"#"+((f=e.value)==null?void 0:f.borderColor),paddingTop:parseFloat((b=(h=e.value)==null?void 0:h.padding)==null?void 0:b.top)+"px",paddingBottom:parseFloat((g=(O=e.value)==null?void 0:O.padding)==null?void 0:g.bottom)+"px",paddingLeft:parseFloat((m=(s=e.value)==null?void 0:s.padding)==null?void 0:m.left)+"px",paddingRight:parseFloat((p=(v=e.value)==null?void 0:v.padding)==null?void 0:p.right)+"px",boxShadow:((w=(y=e.value)==null?void 0:y.shadow)==null?void 0:w.horizontal)+"px "+((A=(E=e.value)==null?void 0:E.shadow)==null?void 0:A.vertical)+"px "+((F=(P=e.value)==null?void 0:P.shadow)==null?void 0:F.blur)+"px "+((x=(C=e.value)==null?void 0:C.shadow)==null?void 0:x.spread)+"px #"+((R=(T=e.value)==null?void 0:T.shadow)==null?void 0:R.color)}},u=()=>{var n,l,c,S,f,h,b,O,g,s,m,v,p,y,w,E,A,P,F,C,x,T,R,I,M,Y;return{backgroundColor:"#"+((n=e.value)==null?void 0:n.bgColor),color:"#"+((l=e.value)==null?void 0:l.color),border:((c=e.value)==null?void 0:c.border)+"px "+((S=e.value)==null?void 0:S.borderStyle)+" #"+((f=e.value)==null?void 0:f.borderColor),borderRadius:((h=e.value)==null?void 0:h.radius)+"px",maxWidth:((b=e.value)==null?void 0:b.width)+"px",width:"100%",borderColor:"#"+((O=e.value)==null?void 0:O.borderColor),paddingTop:parseFloat((s=(g=e.value)==null?void 0:g.padding)==null?void 0:s.top)+"px",paddingBottom:parseFloat((v=(m=e.value)==null?void 0:m.padding)==null?void 0:v.bottom)+"px",paddingLeft:((y=(p=e.value)==null?void 0:p.padding)==null?void 0:y.left)+"px",paddingRight:((E=(w=e.value)==null?void 0:w.padding)==null?void 0:E.right)+"px",boxShadow:((P=(A=e.value)==null?void 0:A.shadow)==null?void 0:P.horizontal)+"px "+((C=(F=e.value)==null?void 0:F.shadow)==null?void 0:C.vertical)+"px "+((T=(x=e.value)==null?void 0:x.shadow)==null?void 0:T.blur)+"px "+((I=(R=e.value)==null?void 0:R.shadow)==null?void 0:I.spread)+"px #"+((Y=(M=e.value)==null?void 0:M.shadow)==null?void 0:Y.color)}},i=(n,l)=>{var c,S,f,h,b;e.value={bgColor:n==null?void 0:n.background,border:(c=n==null?void 0:n.border)==null?void 0:c.border,borderStyle:(S=n==null?void 0:n.border)==null?void 0:S.style,borderColor:(f=n==null?void 0:n.border)==null?void 0:f.color,radius:(h=n==null?void 0:n.border)==null?void 0:h.radius,width:l,padding:(n==null?void 0:n.padding)||defaultPadding,shadow:(n==null?void 0:n.shadow)||defaultShadow,margin:n==null?void 0:n.margin,marginTop:((b=n==null?void 0:n.margin)==null?void 0:b.top)??(n==null?void 0:n.marginTop)}};return{getFormWidth:computed(()=>{var n;return((n=e==null?void 0:e.value)==null?void 0:n.width)||"auto"}),getFormStyle:a,setFormStyle:i,getSurveyStyle:u,hasCustomMarginTop:t,getMarginStyle:o}},verifyRedirectedPayment=async(e,t,r,o)=>{try{const a=usePreviewStore();useRouter().replace({query:void 0});const i=a.value.locationId;let d;if(r){const n={altId:i,altType:"location",transactionId:r};d=await PaymentServices.verifyGenernalPayment(n)}else{let n;const l=sessionStorage.getItem(`formOrderResponse-${t}`);l&&(n=JSON.parse(l));const c={altId:i,altType:"location",orderId:n.order._id,paymentIntentId:e,setupIntentId:o,isAuth:!!o,attribution:{eventData:attributionEventData(),sessionId:getSessionId(i),sessionFingerprint:getSessionFingerprint(i)}};d=await PaymentServices.verifyStripePayment(c)}if(d.success)return d;throw new Error(d.message)}catch{return window.alert("An error occured while trying to process your payment. Please try again."),!1}finally{sessionStorage.removeItem("formOrderResponse"),sessionStorage.removeItem("formContactResponse"),sessionStorage.removeItem("submissionResponse")}},findIdByQueryKey=(e,t)=>{for(const r of e)if(r.hiddenFieldQueryKey===t&&(r.Id||r.id))return r.Id||r.id;return null},calculateScore=(form,formFields,tdata)=>{const data={...tdata},scoreFields=form==null?void 0:form.fields.filter(e=>e.dataType==="SCORE"),operatorsAndNumbers=["â†","(",")","*","7","8","9","-","4","5","6","+","1","2","3","/","0","."],results=scoreFields.map(scoreField=>{const calculation=scoreField==null?void 0:scoreField.calculation;if(!(calculation!=null&&calculation.length))return null;const expression=calculation.map((e,t)=>{var o,a,u;const r=findIdByQueryKey(formFields,e);if(r!==null&&(e=r),data[e]){const i=form==null?void 0:form.fields.find(l=>(l==null?void 0:l.id)===e),d=i==null?void 0:i.enableCalculations;if(Array.isArray(i==null?void 0:i.picklistOptions)&&i.picklistOptions.length>0&&!d)return 0;let n;if(d&&(n=i==null?void 0:i.calculatedOptions),(i==null?void 0:i.dataType)==="TEXTBOX_LIST"&&typeof data[e]=="object"){let l=0;for(const c in data[e])if(data[e].hasOwnProperty(c)&&typeof data[e][c]=="string"&&data[e][c].trim()!==""){const S=(o=i.picklistOptions.find(h=>h.id===c))==null?void 0:o.label,f=(a=n.find(h=>h.label===S))==null?void 0:a.calculatedValue;S&&f&&(l+=parseFloat(f))}return l}if((i==null?void 0:i.dataType)==="RATING"&&((u=data[e])!=null&&u.rating))return data[e].rating;if(n){if(Array.isArray(data[e]))return data[e].reduce((l,c)=>{const S=n.find(f=>f.label===c);return l+(S&&S.calculatedValue?S.calculatedValue:0)},0);{const l=n.find(c=>c.label===data[e]);return l&&l.calculatedValue?l.calculatedValue:0}}else return typeof data[e]=="string"?isNaN(parseFloat(data[e]))?0:parseFloat(data[e]):data[e]}else return operatorsAndNumbers.includes(e)?e:0}).join("").split(" ").reduce((e,t,r,o)=>r<o.length-1&&o[r+1]!=="."&&!isNaN(Number(o[r+1]))?e+t:e+t+" ","").trim();try{const result=parseFloat(eval(expression.replace(/--/g,"- -")).toFixed(2));return{hiddenFieldQueryKey:scoreField.tag,result}}catch(e){return console.error("Error evaluating expression:",expression,e),{hiddenFieldQueryKey:scoreField.tag,result:0}}});return results.filter(e=>e!==null)},validURL=e=>{var t=urlRegex;return!!t.test(e)},calculateProductScore=(e,t,r)=>{let o=[];return o=t.reduce((u,i)=>[...u,...i.slideData],[]),calculateScore({fields:o},o,e).forEach(({hiddenFieldQueryKey:u,result:i})=>{e[u]=i}),e},imageLoaded=(e,t)=>{e&&t&&window.parent.postMessage(["highlevel.setHeight",{height:t.clientHeight,id:e}],"*")},calculateCategoryBaseScore=(e,t)=>{let r={};const o={};return e.forEach(a=>{r[a.value]=0,o[a.value]=0}),r.overAllScore=0,o.overAllScore=0,t.forEach(a=>{let u={},i=0;a.slideData.forEach(d=>{if(d.scoreByCategory){let n=d.scoreByCategory;if(fieldTypeMaxScore.includes(d.dataType)){const l=getMaxScoreFromOptions(n,o);i=l.maxScoreOutOfAllOptions,u=l.initialFieldLevelCategorybase}else{const l=getSumScoreFromOptions(n,o);i=l.maxScoreOutOfAllOptions,u=l.initialFieldLevelCategorybase}}}),Object.keys(u).forEach(d=>{if(d!=="overAllScore"){const n=u[d];r[d]+=n,u[d]=0}}),r.overAllScore+=i}),r},getMaxScoreFromOptions=(e,t,r)=>{let o=0,a=Object.assign({},t);return Object.keys(e).forEach(u=>{const i=e[u],d=a[i.category]<i.score?i.score:a[i.category];a[i.category]=d,o=o<i.score?i.score:o}),{maxScoreOutOfAllOptions:o,initialFieldLevelCategorybase:a}},getSumScoreFromOptions=(e,t)=>{let r=0,o=Object.assign({},t);return Object.keys(e).forEach(a=>{const u=e[a];u.category!=="overAllScore"&&(o[u.category]+=u.score),r+=u.score}),{maxScoreOutOfAllOptions:r,initialFieldLevelCategorybase:o}},convertDataToFormDataType=async e=>{const t=new FormData,r=Object.keys(e),o={};return r.forEach(async a=>{var u;if(e[a]instanceof File)t.append(a,e[a]);else if((u=e[a])!=null&&u.files){const i=Object.values(e[a].files);i.length&&await Promise.all(i.map(d=>{t.append(a,d)}))}else o[a]=e[a]}),{bodyFormData:t,formData:o}},findFieldFromSlides=(e,t,r)=>{var u;let o=t[e];return(u=r[o])==null?void 0:u.slideData.find(i=>i.tag===e)},calculateCategoryPointScored=(e,t,r,o)=>{const a=Object.keys(t),u={};return e.forEach(i=>{u[i.value]=0}),u.overAllScore=0,a.forEach(i=>{const d=findFieldFromSlides(i,r,o);if(d&&d.scoreByCategory&&Array.isArray(d.picklistOptions)&&d.picklistOptions.length){if(fieldTypeMaxScore.includes(d==null?void 0:d.dataType)){const n=((d==null?void 0:d.picklistOptions)??[]).findIndex(c=>c==t[i]),l=d.scoreByCategory[n];n>=0&&l&&(u[l.category]+=l.score,u.overAllScore+=l.category==="overAllScore"?0:l.score)}fieldTypeSumScore.includes(d==null?void 0:d.dataType)&&t[i].forEach(n=>{const l=((d==null?void 0:d.picklistOptions)??[]).findIndex(S=>S==n),c=d.scoreByCategory[l];l>=0&&c&&(u[c.category]+=c.score,u.overAllScore+=c.category==="overAllScore"?0:c.score)})}}),u},percentage=(e,t)=>parseFloat((e/t*100).toFixed(2))||0,getScoreFormat=(e,t,r)=>r===SCORE_FORMAT.PERCENTAGE?percentage(e,t):r===SCORE_FORMAT.OUT_OF_10?parseFloat((percentage(e,t)/10).toFixed(2))||0:e,calculateCategoryPercentage=(e,t,r,o)=>{var h,b,O,g,s;const a=[],u=[],i=Object.keys(t),d={},n={},l={},c=((b=(h=o.sections.find(m=>m.type==="categoryScoreSettings"))==null?void 0:h.config)==null?void 0:b.scoreFormat)||"percentage",S=((g=(O=o.sections.find(m=>m.type==="overallScoreSettings"))==null?void 0:O.config)==null?void 0:g.overallScoreFormat)||"percentage";e.forEach(m=>d[m.value]=m.label),i.forEach(m=>{if(m!=="overAllScore"){const v=e.find(w=>w.value===m).id;a.push({label:d[m],value:m,id:v});const p=getScoreFormat(r[m],t[m],c),y=getTierForCategory(p,t[m],c,o.tiers);u.push(p),n[m]=p,l[v]={score:p,tier:y.label}}});const f=getScoreFormat(r.overAllScore,t.overAllScore,S);return l.overAllScore={score:f,tier:(s=getTierForCategory(f,t.overAllScore,S,o.tiers))==null?void 0:s.label},{category:a,categoryScore:u,overAllScore:f,categoryWithScore:n,categoryCustomFields:l}},calculatePercentage=(e,t,r)=>r===SCORE_FORMAT.PERCENTAGE?e:r===SCORE_FORMAT.ACTUAL_SCORE?t?(e/t*100).toFixed(2):0:r===SCORE_FORMAT.OUT_OF_10?e*10:e,getTierForCategory=(e,t,r,o)=>{const a=calculatePercentage(e,t,r);return o==null?void 0:o.find(u=>a>=u.fromPercent&&a<=u.toPercent)},getContact=e=>({fullName:e.full_name,emailId:e.email,phoneNumber:e.phone,address:e.address1,city:e.city,state:e.state,zipcode:e.postal_code,country:e.country,companyName:e.company_name}),getHighestLowestScoreCategory=(e,t,r)=>{var d,n;let o={highestScoreCategory:"",highestScore:0},a={lowestScoreCategory:"",lowestScore:1/0};const u=((n=(d=r.sections.find(l=>l.type==="categoryScoreSettings"))==null?void 0:d.config)==null?void 0:n.scoreFormat)||"percentage";for(const l in e)e[l]>o.highestScore&&(o={highestScoreCategory:t.find(c=>c.value===l).label,highestScore:e[l]}),e[l]<a.lowestScore&&(a={lowestScoreCategory:t.find(c=>c.value===l).label,lowestScore:e[l]});a.lowestScore=getScoreAsPerFormatWithSymbol(a.lowestScore,u),o.highestScore=getScoreAsPerFormatWithSymbol(o.highestScore,u);let i={highestCategoryName:o.highestScoreCategory,highestCategoryScore:o.highestScore,lowestCategoryName:a.lowestScoreCategory,lowestCategoryScore:a.lowestScore};return{highestScoreCategory:o,lowestScoreCategory:a,customCategoryCustomField:i}},mapCustomFielsForCategory=(e,t)=>({categoryCustomFields:e.reduce((o,a)=>{var u,i;if(t[a.categoryId])return o={...o,[a.id]:a.type=="tier"?(u=t[a.categoryId])==null?void 0:u.tier:((i=t[a.categoryId])==null?void 0:i.score)??t[a.categoryId]}},{})}),configureFooterStyles=(e,t)=>{var a,u,i,d,n,l,c,S,f,h,b,O,g,s,m,v;let r={},o={};if("footerStyle"in e){const p=e.footerStyle;p.progressBarStyle;const y=p.buttonStyle;if((i=(u=(a=p==null?void 0:p.computedStyles)==null?void 0:a.styles)==null?void 0:u.footer)!=null&&i.fontFamily){const w=`'${p.computedStyles.styles.footer.fontFamily}'`;p.computedStyles.styles.footer.fontFamily=w}r={borderRadius:t().borderRadius||0,theme:p.theme||"steps",enableProgressBar:p.enableProgressBar??!0,stickyFooter:p.stickyFooter??!1,buttonStyle:{fontColor:y.fontColor||"FFFFFF",prevBtnText:y.prevBtnText||"PREV",nextBtnText:y.nextBtnText||"NEXT",submitBtnText:y.submitBtnText||"SUBMIT"},computedStyles:p.computedStyles}}if("mobileFooterStyle"in e&&e.mobileFooterStyle){const p=e.mobileFooterStyle,y=JSON.parse(JSON.stringify(p));if((l=(n=(d=y==null?void 0:y.computedStyles)==null?void 0:d.styles)==null?void 0:n.footer)!=null&&l.fontFamily){const w=`'${y.computedStyles.styles.footer.fontFamily}'`;y.computedStyles.styles.footer.fontFamily=w}if(p.fontFamily&&((S=(c=y==null?void 0:y.computedStyles)==null?void 0:c.styles)!=null&&S.footer)){const w=`'${p.fontFamily}'`;y.computedStyles.styles.footer.fontFamily=w}o={borderRadius:t().borderRadius||0,theme:y.theme||r.theme||"steps",enableProgressBar:y.enableProgressBar??r.enableProgressBar??!0,stickyFooter:y.stickyFooter??r.stickyFooter??!1,buttonStyle:{fontColor:((f=y.buttonStyle)==null?void 0:f.fontColor)||((h=r.buttonStyle)==null?void 0:h.fontColor)||"FFFFFF",prevBtnText:((b=y.buttonStyle)==null?void 0:b.prevBtnText)||((O=r.buttonStyle)==null?void 0:O.prevBtnText)||"PREV",nextBtnText:((g=y.buttonStyle)==null?void 0:g.nextBtnText)||((s=r.buttonStyle)==null?void 0:s.nextBtnText)||"NEXT",submitBtnText:((m=y.buttonStyle)==null?void 0:m.submitBtnText)||((v=r.buttonStyle)==null?void 0:v.submitBtnText)||"SUBMIT"},computedStyles:y.computedStyles}}else o=r;return{footerStyle:r,mobileFooterStyle:o}},getScoreAsPerFormatWithSymbol=(e,t)=>t===SCORE_FORMAT.PERCENTAGE?e+"%":t===SCORE_FORMAT.ACTUAL_SCORE?e:t===SCORE_FORMAT.OUT_OF_10?e+"/10":e;function internalLog(...e){getUriParams("internalLog")&&getUriParams("internalLog")=="ghl_team"&&console.log(e)}function isInIframe(){try{return window.self!==window.top}catch{return!0}}function guessUrl(e,t){let r=e;if(e||(r=document.location.href),r&&t){let o=new URL(r);internalLog("function guessUrl: ",r,t),Object.keys(t).forEach(a=>{o.searchParams.has(a)||o.searchParams.append(a,t[a])}),internalLog("function guessUrl newer url: ",o.href),r=o.href}return!e&&isInIframe()&&(r=document.referrer||r),r}function uriParams(e){const t={};if(!e)return t;try{return new URL(e).searchParams.forEach((o,a)=>{t[a]=o}),t}catch{return console.error("full url missing: ",e),t}}function getUriParams(e,t){const r=uriParams(t||guessUrl());return e in r?r[e]:""}function getCampaign(e){return getUriParams("utm_campaign",e)||getUriParams("campaign",e)}function getKeyword(e){return getUriParams("keyword",e)||getUriParams("utm_term",e)||getUriParams("utm_content",e)}function getAdSource(e){if(getUriParams("gclid",e))return"adword";if(getUriParams("msclkid",e))return"bing";if(getUriParams("dclid",e))return"yahoo";const t=getUriParams("utm_source",e),r=getCampaign(e);return t&&t.toLowerCase()=="facebook"&&r?"facebook":t&&t.toLowerCase()=="fb_ad"&&r?"fb_ad":t&&t.toLowerCase()=="linkedin_ad"&&r?"linkedin_ad":t&&t.toLowerCase()=="twitter_ad"&&r?"twitter_ad":""}function getBaseUrl(){return`${useRuntimeConfig().public.REST_API_URLS}/attribution_service`}function referrer(e,t){const r=getUriParams("rf");if(r&&typeof r=="string"&&r=="false")return"";let o;try{t&&typeof t=="string"&&(o=new URL(t).host)}catch{}if(e&&!e.includes(o))return e;const a=getUriParams("hl_referrer");return a||(!isInIframe()&&document.referrer&&!document.referrer.includes(document.location.origin)?document.referrer:"")}function getReferrerSource(e,t){if(e==="")return"direct";if(e.includes("google"))return t.includes("gclid")?"google paid":"google organic";if(e.includes("twitter"))return"twitter";if(e.includes("bing"))return t.includes("msclkid")?"bing paid":"bing organic";if(e.includes("facebook"))return"facebook";if(e.includes("yahoo"))return t.includes("dclid")||t.includes("yahoo")?"yahoo paid":"yahoo organic";if(e.includes("duckduckgo"))return"duckduckgo";{const r=document.createElement("a");return r.setAttribute("href",e),r.hostname}}function isLocalStorageAccessible(e){try{const t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),!0}catch{return!1}}function getStorageItem(e){if(isLocalStorageAccessible("localStorage"))return localStorage.getItem(e)}function setStorageItem(e,t){isLocalStorageAccessible("localStorage")&&localStorage.setItem(e,t)}function removeStorageItem(e){isLocalStorageAccessible("localStorage")&&localStorage.removeItem(e)}function getCookieFromLocalStore(e){if(!isLocalStorageAccessible("localStorage"))return;const t=localStorage.getItem(e);if(!t)return null;const r=JSON.parse(t);return new Date().getTime()>r.expiry?(localStorage.removeItem(e),null):r.value}function getAttributionCookie(e){const t=getCookieFromLocalStore(e);if(t)return t;const r=e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),o=document.cookie.match(new RegExp("(^| )"+r+"=([^;]+)"));return o&&o[2]?o[2]:""}function setCookiesOnLocalStorage(e,t,r){if(!isLocalStorageAccessible("localStorage"))return;const a={value:t,expiry:new Date().getTime()+r};localStorage.setItem(e,JSON.stringify(a))}function setCookie(e,t,r){if(isLocalStorageAccessible("localStorage")){var o=31536e6;r&&(o=r*24*60*60*1e3),setCookiesOnLocalStorage(e,t,o)}else{let a="";if(r){let u=new Date;u.setTime(u.getTime()+r*24*60*60*1e3),a="; expires="+u.toUTCString()}document.cookie=e+"="+(t||"")+a+"; path=/"}}function setCookieMinute(e,t,r){if(isLocalStorageAccessible("localStorage"))r||(r=1),setCookiesOnLocalStorage(e,t,r*60*1e3);else{let o="";if(r){const a=new Date;a.setTime(a.getTime()+r*60*1e3),o="; expires="+a.toUTCString()}document.cookie=e+"="+(t||"")+o+"; path=/"}}function historyKey(e){return e=e||getAttributionCookie("location_id"),e?`${HISTORY_KEY}_${e}`:HISTORY_KEY}function userSessionKey(e){return e=e||getAttributionCookie("location_id"),e?`${USER_SESSION_KEY}${e}_session_id`:`${USER_SESSION_KEY}id`}function contactSessionHistoriesKey(e){return e=e||getAttributionCookie("location_id"),`${USER_SESSION_HISTORY_KEY}${e}`}function userFingerprintKey(e){return e=e||getAttributionCookie("location_id"),`${USER_FINGERPRINT_KEY}${e}_fingerprint`}function firstSessionKey(e){return`${FIRST_EVENT_KEY}${e}`}function isBot(){return/bot|google|baidu|bing|msn|duckduckbot|teoma|slurp|yandex/i.test(navigator.userAgent)}async function request(e,t){try{var r=await fetch(e,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});return await r.json()}catch{return{}}}function getFBP(){return getAttributionCookie("_fbp")}function getFBC(){return getAttributionCookie("_fbc")}function parseJSON(e){if(!e)return null;try{return JSON.parse(e)}catch(t){return console.error(t),null}}class UserSessionAttribution{constructor(t,r){D(this,"baseUrl");D(this,"locationId");D(this,"fingerprint");D(this,"type");D(this,"parentId");D(this,"parentName");this.baseUrl=getBaseUrl(),this.locationId=t,this.fingerprint=r}eventData(t,r){let o,a;if(this.locationId){let i=getStorageItem(contactSessionHistoriesKey(this.locationId));i&&(o=i),a=getAttributionCookie(firstSessionKey(this.locationId))}internalLog("function eventData: ",this.locationId,a);let u=guessUrl(t,a==null?void 0:a.url_params);return{source:getReferrerSource(referrer(r,t),document.location.href),referrer:referrer(r,t)||(a==null?void 0:a.referrer)||"",keyword:getKeyword(u),adSource:getAdSource(u),url_params:uriParams(u),page:{url:u,title:document.title},timestamp:Date.now(),campaign:getCampaign(u),contactSessionIds:parseJSON(o),fbp:getFBP(),fbc:getFBC()}}pageVisitData(t,r,o){return internalLog("function pageVisitData: ",t,r,o),{...this.eventData(t,r),type:"page-visit",parentId:getUriParams("trigger_link")?getUriParams("trigger_link"):this.parentId||"",pageVisitType:getUriParams("trigger_link")?"trigger-link":this.type||"",domain:document.domain,version:"v3",parentName:this.parentName||"",fingerprint:null,documentURL:document==null?void 0:document.URL,...o}}async store(t,r,o,a,u,i,d){internalLog("extras form script: ",d),this.locationId=t;var n=this.fingerprint||getAttributionCookie("fingerprint"),l=getAttributionCookie(userSessionKey(t));if(this.type=r,this.parentId=o,this.parentName=a,isBot())return;const c=referrer(i,u);if(l||setCookieMinute(userSessionKey(t),"temp",1),l=="temp")return;l||(internalLog(`Not found sessionId so removing older sessions: ${userSessionKey(t)}`),removeStorageItem(historyKey(t))),l&&setCookieMinute(userSessionKey(t),l,30);let S=parseJSON(getStorageItem(historyKey(t)));if(internalLog("function store: history",S),S&&S.sessions){const g=S.sessions[S.sessions.length-1],s=getAttributionCookie(firstSessionKey(t));let m=guessUrl(u,s==null?void 0:s.url_params);(g.referrer!=(referrer(i,u)||(s==null?void 0:s.referrer)||"")||g.campaign!=getCampaign(m))&&(internalLog(`Referrer and campaign change > newReferrer: ${referrer(i,u)} > old referrer: ${g.referrer}`),S=null,l=null,removeStorageItem(historyKey(t)))}if(S)if(l&&S&&r!="call-swap"){internalLog("function store: sessionId & history",l,S);var b=S.sessions,O=this.pageVisitData(u,i,d);internalLog("function store: newSession",O);try{var h=await request(`${this.baseUrl}/user_session_v3/update_session/${l}`,{locationId:t,sessions:O});O.fingerprint=h.fingerprint,setStorageItem(historyKey(t),JSON.stringify({sessions:[...b,O]}))}catch(g){console.error(g)}}else removeStorageItem(historyKey(t)),await this.store(t,r,o,a,u,i);else{var f=this.pageVisitData(u,i,d);internalLog("function store: sessions",f);try{var h=await request(`${this.baseUrl}/user_session_v3/create_session`,{sessions:f,initialReferrer:c,locationId:t,fingerprint:n,sessionId:l});(!l||l!=h.sessionId)&&setCookieMinute(userSessionKey(t),h.sessionId,30),f.fingerprint=h.fingerprint,setStorageItem(historyKey(t),JSON.stringify({sessions:[f]}));let g=parseJSON(getStorageItem(contactSessionHistoriesKey(t)));g?g.ids.push(h.sessionId):(g={ids:[h.sessionId]},setCookieMinute(firstSessionKey(t),f,30)),internalLog("function store: contactSessionIds",g),setStorageItem(contactSessionHistoriesKey(t),JSON.stringify(g))}catch(g){console.error(g),removeStorageItem(historyKey(t))}}}async create(t,r,o,a,u,i,d){this.locationId=t;var n=getAttributionCookie(userSessionKey(t)),l=getUriParams("sessionId");let c=10;(!n||n=="temp")&&(c=100),setTimeout(async()=>{l&&setCookie(userSessionKey(t),l,365),await this.store(t,r,o,a,u,i,d)},c)}update(t){const r=t.sessionId||"",o=t.locationId||"";this.locationId=o,r&&(setCookieMinute(userSessionKey(o),r,30),removeStorageItem(contactSessionHistoriesKey(o)))}getCookie(t){return getAttributionCookie(t)}setCookies(t,r){t&&r&&setCookie(t,r)}getSessionId(t){return getAttributionCookie(userSessionKey(t||this.locationId))}getUserFingerprint(t){return getAttributionCookie(userFingerprintKey(t||this.locationId))}setUserFingerprint(t,r){return setCookie(userFingerprintKey(t||this.locationId),r)}}const setupSession=async()=>{var e=typeof window>"u"?{}:window,t=e.userSessionAttribution;t||(t=e.userSessionAttribution=new UserSessionAttribution)};export{validPhone as A,validUrl as B,urlRegex as C,verifyEmail as D,validEmail as E,isDateEarlier as F,hasAlphabet as G,getFBC as a,calculateProductScore as b,customParseFormat as c,calculateCategoryBaseScore as d,fillDataForStandardFieldUri as e,fillDataFromCookie as f,getFBP as g,getTotalFilesSize as h,imageLoaded as i,getCountryFieldValue as j,getHiddenFieldValue as k,calculateCategoryPointScored as l,calculateCategoryPercentage as m,getHighestLowestScoreCategory as n,mapCustomFielsForCategory as o,convertDataToFormDataType as p,configureFooterStyles as q,referrer as r,setupSession as s,isEmpty as t,usePreviewStyle as u,validURL as v,emailRegex as w,verifyRedirectedPayment as x,calculateScore as y,getContact as z};
