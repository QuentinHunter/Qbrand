import{d as ye,j as he,c as C,r as c,o as ve,A as ge,a9 as be,bl as U,E as L,u as o,a as l,b as u,e as r,m as f,l as s,y,t as h,M as Q,a8 as I,s as Ce,k as O,H as pe,aw as Z,aL as ke,N as J,L as M,bv as Ve,q as Pe,aA as X,w as Se,x as Fe,I as Le}from"./8xvvzpeQ.js";import{A as _,t as ee,B as Ie}from"./Dmt1cPZn.js";import{F as Te}from"./Cvp-3ycD.js";import{l as Ee,i as xe}from"./9YG7YuCy.js";import{V as qe,o as we}from"./CxyoZLpX.js";import{S as A}from"./BJsWKcEX.js";import{C as Oe}from"./65dpyqit.js";import{_ as Ne}from"./BrQJU4K_.js";import{a as Re}from"./BCGqgtjN.js";import{u as Ue}from"./DCID7Uvk.js";const Me=Se(()=>Fe(()=>import("./DleH2ADF.js"),[],import.meta.url).then(t=>t.default||t)),Ae=["id"],$e=["innerHTML"],Be=["for"],De={key:0},je={key:2,class:"flex-col"},ze=["value","name","placeholder","id","data-q","data-required"],Ke={class:"flex"},He={key:0,class:"verified-text"},We=["src"],Ye={key:1,class:"verification-container"},Ge={key:3},Qe={class:"flex-col"},Ze=["placeholder","name","id","data-q","data-required"],Je={key:4,class:"flex-col"},Xe=["type","placeholder","name","id","data-q","data-required"],_e={key:5,class:"recaptcha-container recaptch-top-margin"},et={key:0},tt={key:6,id:"error-container",class:"error"},it={key:7,id:"error-container",class:"error"},ft=ye({__name:"TextElement",props:{kind:{type:String},item:{type:Object},formLabelVisible:{type:Boolean},formLabelAlignment:{type:String},phoneCountryIncluded:{type:Object},phoneCountryCode:{type:Object},formattedPhone:{type:Object},locationCountry:{type:String,default:"us"},formFieldsValue:{type:Object},phoneFields:{type:Object},phoneCountryDerived:{type:String},layoutType:{type:[Number,Boolean]},checkFullWidthPosition:{type:Boolean},fontSize:{type:[Number,String]},locationId:{type:String},mediumId:{type:String},errors:{type:Object,default:()=>({})}},emits:["addOrUpdateError","isSlideMovable","customFieldPhoneNumberUpdate","updatePhoneCountryDerived","verifyPhone","updateToken"],setup(t,{expose:te,emit:ie}){const{t:ne}=he(),$=Le(),e=t,T=C(()=>{var n;return((n=e.item)==null?void 0:n.enableCountryPicker)!==!1}),B=c(),p=c(),v=ie,oe=n=>{const i=n.target.value;e.phoneCountryIncluded[e.item.tag]=i,e.formattedPhone[e.item.tag]=i,e.formFieldsValue[e.item.tag]=i,x()},D=()=>{x()},j=()=>{x()},ae=C(()=>e.kind=="form"),E=C(()=>e.kind=="survey"),z=C(()=>e.errors[e.item.tag]),le=()=>{var n;((n=e.item)==null?void 0:n.tag)==="phone"&&we(()=>{Ue(Ee(T,{intlTelFunc:()=>{T.value&&xe(H)}}))})};ve(()=>{var n;((n=e.item)==null?void 0:n.tag)==="phone"&&Te.getGeoLocation().then(i=>{const d=i.country!=="ZZ"?i.country:e.locationCountry;e.phoneCountryCode[e.item.tag]=d,re(d),e.phoneCountryIncluded[e.item.tag]&&e.phoneCountryCode[e.item.tag]&&N({tag:e.item.tag})}).catch(i=>{console.error("Error while fetching headers: ",i)})});const N=n=>{v("customFieldPhoneNumberUpdate",n)},K=n=>{E.value&&v("isSlideMovable",n)},H=()=>{var i,d;const n=B.value;n&&(p.value=(d=window==null?void 0:window.intlTelInput)==null?void 0:d.call(window,n,{preferredCountries:["us","gb","ca","au"],initialCountry:((i=e.locationCountry)==null?void 0:i.toLowerCase())||"us"}),n.addEventListener("countrychange",()=>{if(!p.value)return;const a=p.value.getNumber(),G=p.value.getSelectedCountryData().iso2;e.phoneCountryIncluded[n.name]=a,e.phoneCountryCode[n.name]=G?G.toUpperCase():"US",N({tag:n.name})}))},re=n=>{v("updatePhoneCountryDerived",n)},x=()=>{var i;const n=e.formFieldsValue[e.item.tag];e.item.required&&ee(n)?m(e.item.tag,((i=e.item)==null?void 0:i.error)??` ${e.item.label} is required`):m(e.item.tag,null)},de=n=>{var d,a;if(E.value)return;const i=e.formFieldsValue[e.item.tag];if(e.item.required&&ee(i))m(e.item.tag,((d=e.item)==null?void 0:d.error)??` ${e.item.label} is required`);else if(e.item.tag==="phone")if(!_(i,e.phoneCountryCode[e.item.tag]?e.phoneCountryCode[e.item.tag]:e.locationCountry))m(e.item.tag,ne("invalid_phone_no"));else if(e.item.enableValidatePhone&&!((a=e.item)!=null&&a.hidden)&&!q.value&&i){m(e.item.tag,"Phone is not verified!");return}else m(e.item.tag,null);else e.item.tag==="website"&&!Ie(i)?m(e.item.tag,"Invalid url"):m(e.item.tag,null)},k=c(""),g=c(null),R=c(null),V=c(!1),q=c(!1),P=c(!1),S=c(!1),b=c(),w=c(""),ue=n=>{if(!n){w.value="Verification failed! Please try again";return}w.value="",b.value=n},se=C(()=>e.formFieldsValue[e.item.tag]?e.item.enableValidatePhone&&_(e.formFieldsValue[e.item.tag],e.phoneCountryCode[e.item.tag]?e.phoneCountryCode[e.item.tag]:e.locationCountry):!1),me=()=>{var d;P.value=!0;const n=(d=window.libphonenumber.parsePhoneNumberFromString(e.formFieldsValue[e.item.tag],e.phoneCountryCode[e.item.tag]?e.phoneCountryCode[e.item.tag]:e.locationCountry))==null?void 0:d.number,i={locationId:e.locationId,phone:n,type:e.kind,mediumId:e.mediumId,captchaToken:b.value};$fetch(`${$.public.FORMS_SERVICE_URL}/forms/verify-phone`,{method:"POST",body:i}).then(a=>{P.value=!1,V.value=!0,R.value=a.token,m(e.item.tag,null),Y()}).catch(a=>{P.value=!1,W(a)})},ce=()=>{const n={locationId:e.locationId,phone:e.formFieldsValue[e.item.tag],type:e.kind,token:R.value,otp:k.value,mediumId:e.mediumId,captchaToken:b.value};$fetch(`${$.public.FORMS_SERVICE_URL}/forms/verify-phone`,{method:"POST",body:n}).then(i=>{i!=null&&i.ok&&(g.value=null,q.value=!0,V.value=!1,m(e.item.tag,null),Y(),v("verifyPhone","Yes"),v("updateToken",{value:R.value,type:"phone",id:"phone"}))}).catch(i=>{W(i)})},W=n=>{var i,d;n.status===400&&(b.value=void 0,S.value=!1),[429].includes(n.status)?(S.value=!0,m(e.item.tag,X.CAPTCHA_RETRY)):m(e.item.tag,((i=n.data)==null?void 0:i.message)||n.data),E.value&&([429].includes(n.status)?(S.value=!0,g.value=X.CAPTCHA_RETRY):g.value=((d=n.data)==null?void 0:d.message)||n.data),console.error(n)},Y=()=>{b.value=void 0,S.value=!1},fe=()=>{k.value="",V.value=!1,m(e.item.tag,null),g.value=null},m=(n,i)=>{v("addOrUpdateError",{tag:n,error:i})};ge(()=>e.phoneCountryDerived,(n,i)=>{i!==n&&T.value&&H()}),be(()=>{var n;(n=p.value)==null||n.destroy()});const F=C(()=>[U.ONE_COLUMN,U.TWO_COLUMN,U.SINGLE_LINE].includes(e.layoutType)?e.item.fieldWidthPercentage?e.item.fieldWidthPercentage<=50:!0:e.layoutType===!0&&e.checkFullWidthPosition);return te({validate:de,validateRequired:x,item:e.item}),(n,i)=>{const d=Me;return L((l(),u("div",null,[r("div",{class:f([{"d-none":t.item.hidden},"field-container"])},[r("div",{id:"form-"+t.item.tag,class:f(["form-builder--item",{"form-builder--item-input":t.kind=="survey"}])},[o(E)&&t.item.description!==void 0?(l(),u("label",{key:0,innerHTML:t.item.description,class:"item-description"},null,8,$e)):s("",!0),t.formLabelVisible?(l(),u("label",{key:1,class:f([o(Re)(t.item.labelAlignment,t.formLabelAlignment),"field-label"]),for:t.item.tag},[y(h(t.item.label||"Â ")+" ",1),t.item.required?(l(),u("span",De,"*")):s("",!0)],10,Be)):s("",!0),t.item.tag=="phone"?(l(),u("div",je,[L(r("div",{class:f(["phone-input",o(F)?"block":"flex"])},[t.item.tag=="phone"?(l(),u("input",{key:0,onInput:oe,value:t.formattedPhone[t.item.tag],type:"tel",name:t.item.tag,placeholder:!t.formLabelVisible&&t.item.required?t.item.placeholder+"*":t.item.placeholder,autocomplete:"off",class:f(o(T)?"countryphone":"form-control"),ref:a=>B.value=a,id:t.item.tag,"data-q":t.item.hiddenFieldQueryKey,"data-required":t.item.required,onKeyup:i[0]||(i[0]=a=>N(t.item)),onKeydown:i[1]||(i[1]=Q(I(a=>K({}),["prevent"]),["enter"]))},null,42,ze)):s("",!0),o(se)?(l(),u("button",{key:1,onClick:I(me,["prevent"]),class:f(["verify-phone-btn",o(F)?"mt-3":""]),style:Ce({fontSize:`${t.fontSize}px`})},[r("div",Ke,[o(P)?(l(),O(Ne,{key:0,style:{"padding-right":"5px","padding-top":"2px","margin-left":"-16px"},loading:o(P),color:"#188bf6",size:"15px"},null,8,["loading"])):s("",!0),i[7]||(i[7]=r("div",null,"Verify Phone",-1))])],6)):s("",!0)],2),[[pe,!o(V)&&!o(q)]]),o(q)?(l(),u("div",He,[r("img",{src:o(Oe),height:"18",width:"18",alt:"verified",class:"mr-3"},null,8,We),r("span",null,[i[8]||(i[8]=y(" Your phone ")),r("b",null,h(t.formFieldsValue[t.item.tag]),1),i[9]||(i[9]=y(" has been successfully verified."))])])):s("",!0),o(V)?(l(),u("div",Ye,[r("p",null,[i[10]||(i[10]=y(" Your verification code has been sent to ")),r("b",null,h(t.formFieldsValue[t.item.tag]),1),i[11]||(i[11]=y(". ")),i[12]||(i[12]=r("br",null,null,-1)),i[13]||(i[13]=y("Kindly review your sms and insert the code below to complete the verification process. "))]),r("div",{class:f(["phone-input mt-3",o(F)||o(Z)()?"block":"flex"])},[L(r("input",{type:"text","onUpdate:modelValue":i[2]||(i[2]=a=>ke(k)?k.value=a:null),maxlength:"6",class:"otp",placeholder:"Enter OTP"},null,512),[[J,o(k)]]),r("div",{class:f(o(F)||o(Z)()?"mt-3 block":"flex")},[r("button",{onClick:I(ce,["prevent"]),class:f(["confirm-btn",o(F)?"mb-3":""])}," Confirm Code ",2),r("button",{onClick:I(fe,["prevent"]),class:"reset-btn"}," Edit Phone ")],2)],2)])):s("",!0),t.item.shortLabel?(l(),O(A,{key:2},{default:M(()=>[y(h(t.item.shortLabel),1)]),_:1})):s("",!0)])):o(ae)&&t.item.tag=="website"?(l(),u("div",Ge,[r("div",Qe,[L(r("input",{"onUpdate:modelValue":i[3]||(i[3]=a=>t.formFieldsValue[t.item.tag]=a),placeholder:!t.formLabelVisible&&t.item.required?t.item.placeholder+"*":t.item.placeholder,name:t.item.tag,type:"text",onInput:D,onBlur:j,class:"form-control",id:t.item.tag,"data-q":t.item.hiddenFieldQueryKey,"data-required":t.item.required},null,40,Ze),[[J,t.formFieldsValue[t.item.tag]]]),t.item.shortLabel?(l(),O(A,{key:0},{default:M(()=>[y(h(t.item.shortLabel),1)]),_:1})):s("",!0)])])):(l(),u("div",Je,[L(r("input",{"onUpdate:modelValue":i[4]||(i[4]=a=>t.formFieldsValue[t.item.tag]=a),type:t.item.type,placeholder:!t.formLabelVisible&&t.item.required?t.item.placeholder+"*":t.item.placeholder,name:t.item.tag,onKeydown:i[5]||(i[5]=Q(I(a=>K({}),["prevent"]),["enter"])),onInput:D,onBlur:j,class:"form-control",id:t.item.tag,"data-q":t.item.hiddenFieldQueryKey,"data-required":t.item.required},null,40,Xe),[[Ve,t.formFieldsValue[t.item.tag]]]),t.item.shortLabel?(l(),O(A,{key:0},{default:M(()=>[y(h(t.item.shortLabel),1)]),_:1})):s("",!0)])),o(S)?(l(),u("section",_e,[Pe(d,{onExpired:i[6]||(i[6]=()=>b.value=""),onVerify:ue}),o(w)?(l(),u("p",et,h(o(w)),1)):s("",!0)])):s("",!0),o(z)?(l(),u("div",tt,h(o(z)),1)):s("",!0),o(g)&&t.item.tag=="phone"?(l(),u("div",it,h(o(g)),1)):s("",!0)],10,Ae)],2)])),[[o(qe),le]])}}});export{ft as _};
