import{P as h}from"./oo_a1T_D.js";import{T as v,f as O,au as _}from"./8xvvzpeQ.js";const A=(e,n,a,l,t)=>{let s=[];return a&&(a==null||a.map(i=>{if(i.selectedPrice._id===n.selectedPrice._id)if(e==="sub"){if(i.quantity===1||t===0)return;i.quantity=t||i.quantity-1}else i.quantity=t||i.quantity+1;s.push(i)})),_(`cart_details_${l}`,JSON.stringify({products:s})),s},F=e=>{if(!e.length)return 0;let n=0;return e.forEach(a=>{n+=B(a)*a.quantity}),n},j=e=>(e==null?void 0:e.availableQuantity)<=0&&e.trackInventory&&!e.allowOutOfStockPurchases,L=async e=>{const n=v();try{const{data:a}=await h.getAllCollectionsByLocation({altId:n.value.locationId,altType:"location",collectionIds:e.join()});return a}catch(a){console.error("Error caught: ",a.message)}},Q=(e,n)=>{var a;return(a=e==null?void 0:e.medias)==null?void 0:a.find(l=>{var t;return(t=l==null?void 0:l.priceIds)==null?void 0:t.includes(n)})},T=e=>e.filter(n=>n.selectedPrice.type==="recurring").length>1,B=e=>{let n=e.selectedPrice.amount;return e.selectedPrice.trialPeriod&&(n=0),n+(e.selectedPrice.setupFee??0)},C=(e,n,a,l)=>{let t={status:"",isDeleted:!1,disablePlusButton:!1,disableMinusButton:e<=1};return a&&!l&&(n===0?(t.status="Out of stock",t.isDeleted=!0,t.completelyOutOfStock=!0,t.disablePlusButton=!0,t.disableMinusButton=!1):e>=n&&(t.status=`Only ${n} in stock`,t.completelyOutOfStock=!1,t.isDeleted=!0,t.prevQuantity=e,t.disablePlusButton=!0,t.disableMinusButton=!1)),t},E=async(e,n)=>{let a=e==null?void 0:e.map(t=>{var s;return(s=t==null?void 0:t.selectedPrice)==null?void 0:s._id}).join(",");const l=await h.getSelectedProductPrices({locationId:n,ids:a});return e=e==null?void 0:e.map(t=>{const s=l.find(o=>o._id===t.selectedPrice._id);if(!s){const o=C(t.quantity,0,!0,!1);return{...t,...o}}t.name=s.product.name,t.selectedProductImage=t.selectedProductImage??s.product.image,t.selectedPrice.name=s.name,t.selectedPrice.amount=s.amount,t.selectedPrice.currency=s.currency,t.selectedPrice.recurring=t.selectedPrice.recurring,t.selectedPrice.setupFee=t.selectedPrice.setupFee,t.selectedPrice.trialPeriod=t.selectedPrice.trialPeriod;const i=C(t.quantity,s.availableQuantity,s.trackInventory,s.allowOutOfStockPurchases);return Object.assign(t,i),t.quantity>=s.availableQuantity&&s.trackInventory&&!s.allowOutOfStockPurchases&&s.availableQuantity>0&&(t.prevQuantity=t.quantity,t.quantity=s.availableQuantity),t}).filter(Boolean),e},M=e=>(e==null?void 0:e.map(a=>a==null?void 0:a.completelyOutOfStock)).includes(!0),U=e=>(e==null?void 0:e.map(a=>a==null?void 0:a.isCompletelyOutOfStock)).includes(!0),$=e=>`${(((e==null?void 0:e.compareAtPrice)-(e==null?void 0:e.amount))*100/(e==null?void 0:e.compareAtPrice)).toFixed(0)}% off`,N=e=>e!=null&&e.carrierRateId?e==null?void 0:e.carrierRateId:e==null?void 0:e._id,J=async(e,n,a,l,t,s,i,o,y,P,f,S)=>{const d=v(),r={limit:e,offset:n,locationId:d.value.locationId,collectionSlug:a,storeId:d.value.funnelId,sendWishlistStatus:S};l&&(r.q=encodeURIComponent(l)),t&&(r.advancedSearch=t),s&&(r.availability=s),i&&(r.minPrice=i),o&&(r.maxPrice=o),y&&(r.sortField=y),P&&(r.sortOrder=P),f&&f.length>0&&(r.productIds=f.join(","));try{return await h.getStoreProducts(r)}catch(m){console.error("Error while fetching products: ",m)}},V=e=>{var n,a,l,t,s;if(e.isLabelEnabled&&((n=e.label)!=null&&n.title)){let i=!0;return(a=e.label)!=null&&a.startDate&&(i=O().isAfter(O((l=e.label)==null?void 0:l.startDate))),(t=e.label)!=null&&t.endDate&&(i=i&&O().isBefore(O((s=e.label)==null?void 0:s.endDate))),i}},W=(e,n,a)=>{var l,t,s,i,o,y,P,f,S,d,r,m,k,I,w;return(l=e==null?void 0:e.cartDetails)==null||l.products.push(n),e.total+=(s=(t=a.value)==null?void 0:t.order)==null?void 0:s.amount,e.taxDetails=(y=(o=(i=a.value)==null?void 0:i.order)==null?void 0:o.taxSummary)==null?void 0:y.map(c=>{var g;const u=(g=e==null?void 0:e.taxDetails)==null?void 0:g.find(b=>b._id===c._id);return u?{...u,amount:u.amount+c.amount}:c}),e.shippingRate?e.shippingRate.amount+=((S=(f=(P=a.value)==null?void 0:P.order)==null?void 0:f.shippingRate)==null?void 0:S.amount)??0:e.shippingRate=(r=(d=a.value)==null?void 0:d.order)==null?void 0:r.shippingRate,(I=(k=(m=a.value)==null?void 0:m.order)==null?void 0:k.additionalChargesSummary)!=null&&I.length&&((w=e.additionalChargesSummary)!=null&&w.length?e.additionalChargesSummary=a.value.order.additionalChargesSummary.map(c=>{var g;const u=(g=e==null?void 0:e.additionalChargesSummary)==null?void 0:g.find(b=>b.name===c.name);return u?{...u,amount:u.amount+c.amount}:c}):e.additionalChargesSummary=a.value.order.additionalChargesSummary),e},z=(e,n,a)=>{var l;if(!e)return"";try{const t=(l=window.libphonenumber)==null?void 0:l.parsePhoneNumberFromString(e,n);return t&&t.isValid()?a?t.formatInternational():t.formatNational():e}catch{return e}},G=(e,n)=>{const a=v(),l=n.filter(t=>{var s,i;return((s=t.selectedPrice)==null?void 0:s._id)!==((i=e.selectedPrice)==null?void 0:i._id)});return a.value.cartItems=l,_(`cart_details_${a.value.funnelId}`,JSON.stringify({products:l})),l},H=async e=>{const n=v();return await h.getStoreProductById({productId:e,locationId:n.value.locationId,sendWishlistStatus:!!n.value.customerLoginToken})};export{$ as a,B as b,E as c,G as d,H as e,J as f,L as g,T as h,j as i,C as j,Q as k,F as l,M as m,U as n,z as o,N as p,W as q,V as s,A as u};
