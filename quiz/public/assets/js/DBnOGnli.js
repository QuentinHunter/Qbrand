import{d as te,j as ie,c as L,r as u,bl as N,a as o,b as r,u as a,l as s,m as f,y as v,t as g,e as n,E as q,N as z,M as le,a8 as I,s as ae,k as B,aw as U,aL as ne,L as oe,q as se,aA as $,w as re,x as me,I as ue}from"./8xvvzpeQ.js";import{D as de,t as H,E as ce}from"./Dmt1cPZn.js";import{C as fe}from"./65dpyqit.js";import{S as ve}from"./BJsWKcEX.js";import{_ as ge}from"./BrQJU4K_.js";import{a as ye}from"./BCGqgtjN.js";import"./oo_a1T_D.js";import"./DR8Wfbq3.js";const he=re(()=>me(()=>import("./DleH2ADF.js"),[],import.meta.url).then(l=>l.default||l)),pe=["innerHTML"],ke=["for"],Ee={key:0},be={class:"flex-col"},Ve=["placeholder","name","data-q","data-required","id"],Ce={class:"flex"},Se={key:1,class:"verified-text"},xe=["src"],Te={key:2,class:"verification-container"},Le={key:2,class:"recaptcha-container recaptch-top-margin"},Ie={key:0},Fe={key:3,id:"error-container",class:"error"},Re={key:4,id:"error-container",class:"error"},Be=te({__name:"EmailElement",props:{kind:{type:String},item:{type:Object},formLabelVisible:{type:Boolean},formLabelAlignment:{type:String},formFieldsValue:{type:Object},layoutType:{type:[Number,Boolean]},checkFullWidthPosition:{type:Boolean},fontSize:{type:[Number,String]},locationId:{type:String},mediumId:{type:String},errors:{type:Object,default:()=>({})}},emits:["addOrUpdateError","isSlideMovable","verifyEmail","updateToken"],setup(l,{expose:W,emit:Y}){const O=ue(),{t:F}=ie(),e=l,V=Y,C=L(()=>e.kind=="survey"||e.kind=="quiz"),w=L(()=>e.errors[e.item.tag]),h=u(!1),p=u(!1),y=u(),S=u(""),j=i=>{if(!i){S.value="Verification failed! Please try again";return}S.value="",y.value=i},D=i=>{C.value&&V("isSlideMovable",i)},K=()=>{P()},G=()=>{P()},P=()=>{const i=e.formFieldsValue[e.item.tag];e.item.required&&H(i)?m(e.item.tag,F("email_error")):m(e.item.tag,null)},Q=()=>{var t;if(C.value)return;const i=e.formFieldsValue[e.item.tag];if(e.item.required&&H(i))m(e.item.tag,F("email_error"));else{if(!ce(i)){m(e.item.tag,F("guest_email_invalid_error"));return}if(e.item.enableValidateEmail&&!((t=e.item)!=null&&t.hidden)&&!x.value&&i){m(e.item.tag,"Email is not verified!");return}m(e.item.tag,null)}},k=u(""),c=u(null),R=u(null),E=u(!1),x=u(!1),J=L(()=>e.item.enableValidateEmail&&de(e.formFieldsValue[e.item.tag])),X=i=>{const t=(i==null?void 0:i.first_name)||"",d=(i==null?void 0:i.last_name)||"";return!(i!=null&&i.full_name)&&!t&&!d?"":(i==null?void 0:i.full_name)||t+(t&&d?" ":"")+d},Z=()=>{h.value=!0;const i={locationId:e.locationId,email:e.formFieldsValue[e.item.tag],type:e.kind,captchaToken:y.value,mediumId:e.mediumId,name:X(e.formFieldsValue)};$fetch(`${O.public.FORMS_SERVICE_URL}/forms/verify-email`,{method:"POST",body:i}).then(t=>{h.value=!1,R.value=t.token,c.value=null,E.value=!0,m(e.item.tag,null),A()}).catch(t=>{h.value=!1,M(t)})},_=()=>{const i={locationId:e.locationId,email:e.formFieldsValue[e.item.tag],type:e.kind,token:R.value,otp:k.value,captchaToken:y.value,mediumId:e.mediumId};$fetch(`${O.public.FORMS_SERVICE_URL}/forms/verify-email`,{method:"POST",body:i}).then(t=>{t!=null&&t.ok&&(c.value=null,x.value=!0,E.value=!1,m(e.item.tag,null),A(),V("verifyEmail","Yes"),V("updateToken",{value:R.value,type:"email",id:"email"}))}).catch(t=>{M(t)})},M=i=>{var t,d;i.status===400&&(y.value=void 0,p.value=!1),[429].includes(i.status)?(p.value=!0,m(e.item.tag,$.CAPTCHA_RETRY)):m(e.item.tag,((t=i.data)==null?void 0:t.message)||i.data),C.value&&([429].includes(i.status)?(p.value=!0,c.value=$.CAPTCHA_RETRY):c.value=((d=i.data)==null?void 0:d.message)||i.data),console.error(i)},A=()=>{y.value=void 0,p.value=!1},ee=()=>{e.formFieldsValue[e.item.tag]="",k.value="",E.value=!1,m(e.item.tag,null),c.value=null},m=(i,t)=>{V("addOrUpdateError",{tag:i,error:t})},b=L(()=>[N.ONE_COLUMN,N.TWO_COLUMN,N.SINGLE_LINE].includes(e.layoutType)?e.item.fieldWidthPercentage?e.item.fieldWidthPercentage<=50:!0:e.layoutType===!0&&e.checkFullWidthPosition);return W({validate:Q,item:e.item}),(i,t)=>{const d=he;return o(),r("div",{class:f(["form-builder--item field-container",{"d-none":l.item.hidden,"form-builder--item-input":l.kind==="survey"}])},[a(C)&&l.item.description!==void 0?(o(),r("label",{key:0,innerHTML:l.item.description,class:"item-description",style:{display:"block"}},null,8,pe)):s("",!0),l.formLabelVisible?(o(),r("label",{key:1,class:f(a(ye)(l.item.labelAlignment,l.formLabelAlignment)),for:l.item.tag},[v(g(l.item.label||"Â ")+" ",1),l.item.required?(o(),r("span",Ee,"*")):s("",!0)],10,ke)):s("",!0),n("div",be,[!a(E)&&!a(x)?(o(),r("div",{key:0,class:f(["email-input",a(b)?"block":"flex"])},[q(n("input",{"onUpdate:modelValue":t[0]||(t[0]=T=>l.formFieldsValue[l.item.tag]=T),placeholder:!l.formLabelVisible&&l.item.required?l.item.placeholder+"*":l.item.placeholder,name:l.item.tag,onKeydown:t[1]||(t[1]=le(I(T=>D({}),["prevent"]),["enter"])),onInput:K,onBlur:G,type:"email",class:"form-control","data-q":l.item.hiddenFieldQueryKey,"data-required":l.item.required,id:l.item.tag},null,40,Ve),[[z,l.formFieldsValue[l.item.tag]]]),a(J)?(o(),r("button",{key:0,onClick:I(Z,["prevent"]),class:f(["preview-common-btn",a(b)?"mt-3":""]),style:ae({fontSize:`${l.fontSize}px`})},[n("div",Ce,[a(h)?(o(),B(ge,{key:0,style:{"padding-right":"5px","padding-top":"2px","margin-left":"-16px"},loading:a(h),color:"#188bf6",size:"15px"},null,8,["loading"])):s("",!0),t[4]||(t[4]=n("div",null,"Verify Email",-1))])],6)):s("",!0)],2)):s("",!0),a(x)?(o(),r("div",Se,[n("img",{src:a(fe),height:"18",width:"18",alt:"verified",class:"mr-3"},null,8,xe),n("span",null,[t[5]||(t[5]=v(" Your email ")),n("b",null,g(l.formFieldsValue[l.item.tag]),1),t[6]||(t[6]=v(" has been successfully verified."))])])):s("",!0),a(E)?(o(),r("div",Te,[n("p",null,[t[7]||(t[7]=v(" Your verification code has been sent to ")),n("b",null,g(l.formFieldsValue[l.item.tag]),1),t[8]||(t[8]=v(". ")),t[9]||(t[9]=n("br",null,null,-1)),t[10]||(t[10]=v("Kindly review your email inbox and insert the code below to complete the verification process. "))]),n("div",{class:f(["email-input mt-3",a(b)||a(U)()?"block":"flex"])},[q(n("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=T=>ne(k)?k.value=T:null),maxlength:"6",class:"otp",placeholder:"Enter OTP"},null,512),[[z,a(k)]]),n("div",{class:f(a(b)||a(U)()?"mt-3 block":"flex")},[n("button",{onClick:I(_,["prevent"]),class:f(["confirm-btn",a(b)?"mb-3":""])}," Confirm Code ",2),n("button",{onClick:I(ee,["prevent"]),class:"reset-btn"}," Edit Email ")],2)],2)])):s("",!0),l.item.shortLabel?(o(),B(ve,{key:3},{default:oe(()=>[v(g(l.item.shortLabel),1)]),_:1})):s("",!0)]),a(p)?(o(),r("section",Le,[se(d,{onExpired:t[3]||(t[3]=()=>y.value=""),onVerify:j}),a(S)?(o(),r("p",Ie,g(a(S)),1)):s("",!0)])):s("",!0),a(w)?(o(),r("div",Fe,g(a(w)),1)):s("",!0),a(c)?(o(),r("div",Re,g(a(c)),1)):s("",!0)],2)}}});export{Be as default};
