var N=Object.defineProperty;var F=(t,e,r)=>e in t?N(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var a=(t,e,r)=>F(t,typeof e!="symbol"?e+"":e,r);import{ap as O,ao as L,am as Y,v as b,I as P,aM as x}from"./8xvvzpeQ.js";import{W as B}from"./Cd5HuFSL.js";import{c as S}from"./Bg1KAb8C.js";var A={exports:{}};(function(t,e){(function(r,n){t.exports=n()})(L,function(){return function(r,n,i){var c=n.prototype,h=function(o){return o&&(o.indexOf?o:o.s)},l=function(o,s,E,k,m){var g=o.name?o:o.$locale(),y=h(g[s]),v=h(g[E]),p=y||v.map(function(D){return D.slice(0,k)});if(!m)return p;var _=g.weekStart;return p.map(function(D,C){return p[(C+(_||0))%7]})},d=function(){return i.Ls[i.locale()]},f=function(o,s){return o.formats[s]||function(E){return E.replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(k,m,g){return m||g.slice(1)})}(o.formats[s.toUpperCase()])},w=function(){var o=this;return{months:function(s){return s?s.format("MMMM"):l(o,"months")},monthsShort:function(s){return s?s.format("MMM"):l(o,"monthsShort","months",3)},firstDayOfWeek:function(){return o.$locale().weekStart||0},weekdays:function(s){return s?s.format("dddd"):l(o,"weekdays")},weekdaysMin:function(s){return s?s.format("dd"):l(o,"weekdaysMin","weekdays",2)},weekdaysShort:function(s){return s?s.format("ddd"):l(o,"weekdaysShort","weekdays",3)},longDateFormat:function(s){return f(o.$locale(),s)},meridiem:this.$locale().meridiem,ordinal:this.$locale().ordinal}};c.localeData=function(){return w.bind(this)()},i.localeData=function(){var o=d();return{firstDayOfWeek:function(){return o.weekStart||0},weekdays:function(){return i.weekdays()},weekdaysShort:function(){return i.weekdaysShort()},weekdaysMin:function(){return i.weekdaysMin()},months:function(){return i.months()},monthsShort:function(){return i.monthsShort()},longDateFormat:function(s){return f(o,s)},meridiem:o.meridiem,ordinal:o.ordinal}},i.months=function(){return l(d(),"months")},i.monthsShort=function(){return l(d(),"monthsShort","months",3)},i.weekdays=function(o){return l(d(),"weekdays",null,null,o)},i.weekdaysShort=function(o){return l(d(),"weekdaysShort","weekdays",3,o)},i.weekdaysMin=function(o){return l(d(),"weekdaysMin","weekdays",2,o)}}})})(A);var z=A.exports;const te=O(z);var R={exports:{}};(function(t,e){(function(r,n){t.exports=n()})(L,function(){var r={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};return function(n,i,c){var h=i.prototype,l=h.format;c.en.formats=r,h.format=function(d){d===void 0&&(d="YYYY-MM-DDTHH:mm:ssZ");var f=this.$locale().formats,w=function(o,s){return o.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(E,k,m){var g=m&&m.toUpperCase();return k||s[m]||r[m]||s[g].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(y,v,p){return v||p.slice(1)})})}(d,f===void 0?{}:f);return l.call(this,w)}}})})(R);var $=R.exports;const re=O($);var U=(t=>(t.ERROR="error",t.BOOKING_STARTED="bookingStarted",t.BOOKING_STEP_STARTED="bookingStepStarted",t.BOOKING_STEP_COMPLETED="bookingStepCompleted",t.BOOKING_COMPLETED="bookingCompleted",t.BOOKING_FAILED="bookingFailed",t.PAGE_VIEW="pageView",t.PAYMENT_STARTED="paymentStarted",t.PAYMENT_COMPLETED="paymentCompleted",t.PAYMENT_FAILED="paymentFailed",t.PAYMENT_CANCELLED="paymentCancelled",t.PAYMENT_EXPIRED="paymentExpired",t.PAYMENT_REDIRECTED="paymentRedirected",t.PAYMENT_ERROR="paymentError",t.FETCH_FREE_SLOTS_ERROR="fetchFreeSlotsError",t.CREATE_APPOINTMENT_ERROR="createAppointmentError",t.FREE_SLOTS_LOADED="freeSlotsLoaded",t.BOOKING_DROPPED_OFF="bookingDroppedOff",t.SERVICE_MENU_PAYMENT_INITIATED="serviceMenuPaymentInitiated",t.SERVICE_MENU_BOOKING_COMPLETED="serviceMenuBookingCompleted",t.SERVICE_MENU_BOOKING_INITIATED="serviceMenuBookingInitiated",t))(U||{});const G=1e4;class V{constructor(){a(this,"sessionId");a(this,"sessionStartTime");a(this,"events");a(this,"currentPageUrl");a(this,"referrerUrl");a(this,"initiateTime");a(this,"bookingStartTime");a(this,"deviceInfo");a(this,"utmParams");a(this,"cumulativeLayoutShift");a(this,"calendarId");a(this,"locationId");a(this,"userId");a(this,"widgetType");a(this,"bookingType");a(this,"isPageViewTracked");a(this,"source");a(this,"isInitialized");a(this,"isFlushing",!1);this.initiateTime=Date.now(),this.sessionId=this.generateSessionId(),this.sessionStartTime=Date.now(),this.events=[],this.currentPageUrl="",this.referrerUrl="",this.bookingStartTime=null,this.deviceInfo=this.getDeviceInfo(),this.utmParams=this.getUtmParams(),this.isInitialized=!1,this.cumulativeLayoutShift=0,this.calendarId="",this.locationId="",this.userId=this.getUserId(),this.widgetType=B.NEO,this.bookingType="",this.isPageViewTracked=!1,this.source=""}init(){this.isInitialized||(document.readyState==="complete"?this.initializeAnalytics():window.addEventListener("load",()=>this.initializeAnalytics()))}getSessionId(){return this.sessionId}setSessionId(e){this.sessionId=e}setWidgetData(e){this.widgetType=e.widgetType,this.bookingType=e.isRecurring?"recurring":"one-time",this.calendarId=e.calendarId,this.locationId=e.locationId,this.source=e.source}setReferrerAndUrl(e){this.referrerUrl=e.referrer,this.currentPageUrl=e.documentURL,this.utmParams=this.getUtmParams(e.documentURL)}initializeAnalytics(){this.currentPageUrl=window.location.href,this.referrerUrl=document.referrer,this.setupEventListeners(),this.isInitialized=!0,window.addEventListener("beforeunload",()=>this.flush()),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&this.flush()}),Y(()=>this.flush(),G)}setupEventListeners(){window.addEventListener("error",e=>{if(console.log("error event",e),e.message==="ResizeObserver loop completed with undelivered notifications.")return e.stopImmediatePropagation(),!1;this.trackError("js_error",e.message)}),window.addEventListener("ResizeObserver:loop",function(e){e.stopImmediatePropagation()})}generateSessionId(){return b()}getDeviceInfo(){const e=navigator.userAgent;let r="unknown",n="unknown",i="desktop";return/Firefox/i.test(e)?r="firefox":/Chrome/i.test(e)?r="chrome":/Safari/i.test(e)?r="safari":/MSIE|Trident/i.test(e)?r="ie":/Edge/i.test(e)&&(r="edge"),/Windows/i.test(e)?n="windows":/Mac OS X/i.test(e)?n="macos":/Linux/i.test(e)?n="linux":/Android/i.test(e)?n="android":/iPhone|iPad|iPod/i.test(e)&&(n="ios"),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e)&&(i="mobile",/iPad|tablet|TabletPC/i.test(e)&&(i="tablet")),{browser:r,os:n,deviceType:i}}getUtmParams(e){const r=new URLSearchParams(e||window.location.search);return{utmSource:r.get("utm_source")||"",utmMedium:r.get("utm_medium")||"",utmCampaign:r.get("utm_campaign")||""}}getUserId(){const e="ghl_analytics_user_id";let r=localStorage.getItem(e);if(!r){r=b();try{localStorage.setItem(e,r)}catch(n){console.error("Failed to save user ID to localStorage:",n)}}return r}async trackEvent(e,r={}){const n={timestamp:new Date().toISOString(),sessionId:this.sessionId,userId:this.userId,eventType:e,calendarId:this.calendarId,locationId:this.locationId,widgetType:this.widgetType,pageUrl:this.currentPageUrl,referrerUrl:this.referrerUrl,bookingType:this.bookingType,ipAddress:"",source:this.source,...this.deviceInfo,...this.utmParams,...r};n.stepName&&(n.eventSubType=S(n.stepName)),n.errorType&&(n.eventSubType=S(n.errorType)),this.events.push(n),(this.events.length>=5||n.eventType==="bookingCompleted")&&await this.flush()}trackPageView(){this.isPageViewTracked||(this.isPageViewTracked=!0,this.trackEvent("pageView",{referrerUrl:this.referrerUrl,loadTime:Math.round(new Date().getTime()-this.initiateTime)||0,duration:Math.round(new Date().getTime()-this.initiateTime)||0}))}trackBookingStarted(e){this.bookingStartTime=Date.now(),this.trackEvent("bookingStarted",e)}trackBookingStep(e){this.trackEvent("bookingStepStarted",{stepName:e,eventSubType:S(e)})}trackBookingCompleted(e){if(!this.bookingStartTime)return;const r=Math.round(Date.now()-this.bookingStartTime);this.trackEvent("bookingCompleted",{duration:r,amount:e.amount,currency:e.currency,eventId:e.eventId}),this.bookingStartTime=null}trackBookingFailed(e,r){if(!this.bookingStartTime)return;const n=Math.round(Date.now()-this.bookingStartTime);this.trackEvent("bookingFailed",{duration:n,errorType:e,eventSubType:S(e),errorMessage:r,metadata:r})}trackError(e,r){this.trackEvent("error",{errorType:e,eventSubType:S(e),errorMessage:r,metadata:r})}trackPerformanceMetrics(){if(!window.performance)return;const e=new PerformanceObserver(r=>{r.getEntries().forEach(i=>{if(i.entryType==="navigation"){const c=i;this.sendPerformanceMetrics({loadTime:Math.round(c.loadEventEnd-c.startTime),ttfb:Math.round(c.responseStart-c.requestStart),pageUrl:this.currentPageUrl})}else if(i.entryType==="paint"&&i.name==="first-contentful-paint")this.sendPerformanceMetrics({fcp:Math.round(i.startTime),pageUrl:this.currentPageUrl});else if(i.entryType==="largest-contentful-paint")this.sendPerformanceMetrics({lcp:Math.round(i.startTime),pageUrl:this.currentPageUrl});else if(i.entryType==="layout-shift"){const c=i;this.cumulativeLayoutShift||(this.cumulativeLayoutShift=0),this.cumulativeLayoutShift+=c.value,this.sendPerformanceMetrics({cls:this.cumulativeLayoutShift,pageUrl:this.currentPageUrl})}else if(i.entryType==="first-input"){const c=i;this.sendPerformanceMetrics({fid:Math.round(c.processingStart-c.startTime),pageUrl:this.currentPageUrl})}})});try{e.observe({entryTypes:["navigation","paint","largest-contentful-paint","layout-shift","first-input"]})}catch(r){console.error("Performance Observer error:",r)}}async sendPerformanceMetrics(e){try{console.group("ðŸ“Š Performance Metrics"),console.groupCollapsed("ðŸ“ˆ Performance Data"),console.table(e),console.groupEnd(),console.groupEnd()}catch(r){console.error("Error sending performance metrics:",r)}}async flush(){if(this.isFlushing||this.events.length===0)return;this.isFlushing=!0;const e=P().public.REST_API_URLS,r=this.source||"";this.events=this.events.map(n=>({...n,calendarId:this.calendarId,locationId:this.locationId,source:r}));try{await fetch(`${e}/calendars/booking-analytics/event/submit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.events),keepalive:!0}),this.logAnalyticsEvents(this.events),this.events=[]}catch(n){console.error("Error sending analytics events:",n)}finally{this.isFlushing=!1}}logAnalyticsEvents(e){}getEvents(){return this.events}}let T=null;const W=()=>(T||(T=new V,T.init()),T),{addHeaderFromCookieForReferer:H}=x();var K=(t=>(t[t.STANDARD=0]="STANDARD",t[t.CUSTOM=1]="CUSTOM",t))(K||{}),j=(t=>(t.CALENDAR="calendar",t))(j||{}),J=(t=>(t.MEETING="meeting",t))(J||{});let I,M={};const X=()=>{var r,n;const t={channel:"APP",source:"WEB_USER",version:"2021-04-15"},e=(n=(r=Intl==null?void 0:Intl.DateTimeFormat())==null?void 0:r.resolvedOptions())==null?void 0:n.timeZone;return e&&(t.timezone=e),H(t),t},u=(t,e)=>{const r=P();return $fetch.create({baseURL:t||r.public.REST_API_URLS,headers:{...X(),...e}})},ne={generateRRuleText:t=>u()("calendars/generate-rrule-text",{method:"POST",body:t}),getRecurringSlots:(t,e)=>{I&&I.abort(),I=new AbortController;const r=I.signal;return u()(`calendars/${t}/recurring-slots`,{params:e,signal:r})},createRecurringEvents:t=>u()("calendars/events/recurring-appointments",{method:"POST",body:t}),getFreeSlots:(t,e)=>{M[e]&&M[e].abort(new DOMException("Aborted due to new request","AbortError"));let r=new AbortController;M[e]=r;const n=W(),i=M[e].signal,c=Date.now(),{calendarId:h,...l}=t;return u()(`calendars/${h}/free-slots`,{params:l,signal:i}).then(d=>{const f=Date.now()-c;return n.trackEvent(U.FREE_SLOTS_LOADED,{duration:f,metadata:JSON.stringify(t)}),d})},updatePaymentDetail:(t,e)=>u()(`calendars/events/payment-status/${t}`,{method:"PUT",body:e}),updatePaymentDetailForRecurringAppointments:(t,e)=>u()(`calendars/events/recurring-appointments/payment-status/${t}`,{method:"PUT",body:e}),cancelAppointment:(t,e)=>{const r=P();return u(r.public.newBaseURL)(`/appointment/${t}/cancel`,{method:"POST",body:{reason:e}})},appointmentBookingLogs:(t,e)=>u(void 0,{"x-parent-trace-context":t})("calendars/events/booking-log",{method:"POST",body:e}).catch(r=>{console.error("Error in appointmentBookingLogs",r)}),createAppointmentOrder:t=>u()("/calendars/events/appointment-order",{body:t,method:"POST"})};export{K as A,ne as C,U as E,re as L,j as O,J as a,W as g,te as l};
